<html>

<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>
    使用订阅号实现微信公众号历史文章爬虫 | 刘小绪同学的博客
</title>
<link rel="shortcut icon" href="https://mengxiaoxu.github.io//favicon.ico?v=1578407258539">
<!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> -->
<link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://lexrus.com/fontdiao/fontdiao/css/fontdiao.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://mengxiaoxu.github.io//styles/main.css">
<!-- js -->
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://mengxiaoxu.github.io//media/js/jquery.sticky-sidebar.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-148716803-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-148716803-1');
    </script>
    
        
            
                <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
                <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
                

                    
                            
</head>

<body>
    <div class="main">
        <div class="header">
    <div class="nav">
        <div class="logo">
            <a href="https://mengxiaoxu.github.io/">
                <img class="avatar" src="https://mengxiaoxu.github.io//images/avatar.png?v=1578407258539" alt="">
            </a>
            <div class="site-title">
                <h1>
                    刘小绪同学的博客
                </h1>
            </div>
        </div>
        <span class="menu-btn fa fa-align-justify"></span>
        <div class="menu-container">
            <ul>
                
                    
                            <li>
                                <a href="/" class="menu">
                                    首页
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/archives" class="menu">
                                    归档
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/tags" class="menu">
                                    标签
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/post/about" class="menu">
                                    关于
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="https://mengxiaoxu.github.io//post/gao-zhi-liang-zhong-wen-du-li-bo-ke/" class="menu">
                                    友链
                                </a>
                            </li>
                            
                                
            </ul>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        $(".menu-btn").click(function() {
            $(".menu-container").slideToggle();
        });
        $(window).resize(function() {

            if (window.matchMedia('(min-width: 960px)').matches) {
                $(".menu-container").css('display', 'block')
            } else {
                $(".menu-container").css('display', 'none')
            }

        });
    });
</script>

            <div id="main-content" class="post-detail main-container">
                <!-- left -->
                <div id="content" class="main-container-left">
                    <article class="post i-card">
                        <h2 class="post-title">
                            使用订阅号实现微信公众号历史文章爬虫
                        </h2>
                        <div class="post-info">
                            <time class="post-time">2018-10-04</time>
                            
                                <a href="https://mengxiaoxu.github.io//tag/pa-chong" class="post-tag i-tag
                            i-tag-">
                            #爬虫
                        </a>
                                
                        </div>
                        
                            <div class="post-feature-image" style="background-image: url('https://mengxiaoxu.github.io//post-images/shi-yong-ding-yue-hao-shi-xian-wei-xin-gong-zhong-hao-li-shi-wen-zhang-pa-chong.jpeg')"></div>
                            
                                <div class="post-content">
                                    <p>微信公众号已经成为生活的一部分了，虽然里面有很多作者只是为了蹭热点，撩读者的 G 点，自己从中获得一些收益；但是不乏好的订阅号，像刘大的<code>码农翻身</code>、曹大的<code>caoz的梦呓</code>等订阅号非常值得阅读。</p>
<p>平时有时候看到一些好的公众号，也会不自觉去查看该公众号的历史文章，然而每次都看不完，下一次再从微信里面打开历史文章，又需要从头翻起。而且对于写了很多年的大号，每次还翻不到底。有一些平台提供了相关的服务，但是得收几十块钱的费用，倒不是缺几十块钱，主要是觉得这种没必要花的钱不值得去浪费。</p>
<p>网上搜如何爬微信公众号历史文章，大致给了三种思路，第一是使用搜狗微信搜索文章，但是好像每次能搜到的不多；第二是使用抓包工具；第三种是使用个人订阅号进行抓取。</p>
<p>简单来说就是使用程序来模拟人的操作，抓取公众号历史文章。首先登录微信公众号个人平台，期间需要管理员扫码才能登录成功。</p>
<pre><code class="language-python">def __open_gzh(self):
    self.driver.get(BASE_URL)
    self.driver.maximize_window()
    username_element = self.driver.find_element_by_name(&quot;account&quot;)
    password_element = self.driver.find_element_by_name(&quot;password&quot;)
    login_btn = self.driver.find_element_by_class_name(&quot;btn_login&quot;)
    username_element.send_keys(USERNAME)
    password_element.send_keys(PASSWORD)
    login_btn.click()
    WebDriverWait(driver=self.driver, timeout=200).until(
        ec.url_contains(&quot;cgi-bin/home?t=home/index&quot;)
    )
    # 一定要设置这一步，不然公众平台菜单栏不会自动展开
    self.driver.maximize_window()
</code></pre>
<p>进入微信公众平台首页后，点击<code>素材管理</code>，然后点击<code>新建图文素材</code>，就会进入到文章写作页面，此时前面打开的微信公众平台首页就不需要了，可以将其关闭。</p>
<figure data-type="image" tabindex="1"><img src="https://mengxiaoxu.github.io//post-images/1569769112098.png" alt=""></figure>
<pre><code class="language-python">def __open_write_page(self):
    management = self.driver.find_element_by_class_name(&quot;weui-desktop-menu_management&quot;)
    material_manage = management.find_element_by_css_selector(&quot;a[title='素材管理']&quot;)
    material_manage.click()
    new_material = self.driver.find_element_by_class_name(&quot;weui-desktop-btn_main&quot;)
    new_material.click()
    # 关闭公众平台首页
    handles = self.driver.window_handles
    self.driver.close()
    self.driver.switch_to_window(handles[1])
</code></pre>
<p>在文章写作页面的工具栏上面有一个超链接按钮，点击超链接即会弹出超链接编辑框，选择查找文章，输入自己喜欢的公众号进行查找，一般第一个就是自己想要的结果，点击对应的公众号，该公众号所有的文章就会通过列表的形式展现出来。</p>
<figure data-type="image" tabindex="2"><img src="https://mengxiaoxu.github.io//post-images/1569769146552.png" alt=""></figure>
<figure data-type="image" tabindex="3"><img src="https://mengxiaoxu.github.io//post-images/1569769155528.png" alt=""></figure>
<figure data-type="image" tabindex="4"><img src="https://mengxiaoxu.github.io//post-images/1569769164616.png" alt=""></figure>
<pre><code class="language-python">def __open_official_list(self):
    # 超链接
    link_click = self.driver.find_element_by_class_name(&quot;edui-for-link&quot;)
    link_click.click()
    time.sleep(3)
    # 查找文章
    radio = self.driver.find_element_by_class_name(&quot;frm_vertical_lh&quot;).find_elements_by_tag_name(&quot;label&quot;)[1]
    radio.click()
    # 输入查找关键字
    search_input = self.driver.find_element_by_class_name(&quot;js_acc_search_input&quot;)
    search_input.send_keys(OFFICIAL_ACCOUNT)
    search_btn = self.driver.find_element_by_class_name(&quot;js_acc_search_btn&quot;)
    search_btn.click()
    # 等待5秒，待公众号列表加载完毕
    time.sleep(5)
    result_list = self.driver.find_element_by_class_name(&quot;js_acc_list&quot;).find_elements_by_tag_name(&quot;div&quot;)
    result_list[0].click()
</code></pre>
<p>文章列表已经展现出来了，直接抓取每条文章超链接的信息即可，每抓取完一页就进入下一页，继续抓取文章列表信息，直到所有文章信息都抓取完毕。</p>
<figure data-type="image" tabindex="5"><img src="https://mengxiaoxu.github.io//post-images/1569769176463.png" alt=""></figure>
<pre><code class="language-python">def __get_article_list(self):
    # 等待文章列表加载
    time.sleep(5)
    total_page = self.driver.find_element_by_class_name(&quot;search_article_result&quot;)\
        .find_element_by_class_name(&quot;js_article_pagebar&quot;).find_element_by_class_name(&quot;page_nav_area&quot;)\
        .find_element_by_class_name(&quot;page_num&quot;)\
        .find_elements_by_tag_name(&quot;label&quot;)[1].text
    total_page = int(total_page)
    articles = []
    for i in range(0, total_page-1):
        time.sleep(5)
        next_page = self.driver.find_element_by_class_name(&quot;search_article_result&quot;)\
            .find_element_by_class_name(&quot;js_article_pagebar&quot;).find_element_by_class_name(&quot;pagination&quot;)\
            .find_element_by_class_name(&quot;page_nav_area&quot;).find_element_by_class_name(&quot;page_next&quot;)
        article_list = self.driver.find_element_by_class_name(&quot;js_article_list&quot;)\
            .find_element_by_class_name(&quot; my_link_list&quot;).find_elements_by_tag_name(&quot;li&quot;)
        for article in article_list:
            article_info = {
                &quot;date&quot;: article.find_element_by_class_name(&quot;date&quot;).text,
                &quot;title&quot;: article.find_element_by_tag_name(&quot;a&quot;).text,
                &quot;link&quot;: article.find_element_by_tag_name(&quot;a&quot;).get_attribute(&quot;href&quot;)
                }
            articles.append(article_info)
        next_page.click()
    return articles
</code></pre>
<p>至此，微信公众号历史文章的爬虫已经实现，其实整个过程只不过是用程序来模拟的了人类的操作。需要注意的是，程序不能设置太快，因为微信做了相关限制，所以设太快会在一段时间内无法使用文章查找功能；另外一点是使用选择器选择页面元素的时候，会有一些坑，而且我发现不同账号登录，有很少部分的页面元素虽然直观上是一样的，但是它的 html 代码有细微的差别。</p>
<p>这个小程序会用到<code>selenium</code>库，和<code>chromedriver</code>，前者直接<code>pip install</code>即可，后者自行下载；另外你还需要一个订阅号才行，本文只实现了关键的文章信息抓取，并没有进行文章信息的持久化存储，<a href="https://github.com/mengxiaoxu/python_spider/blob/master/weixin_gzh/weixin_gzh.py">完整代码</a>在这里。</p>

                                </div>
                    </article>
                    <!--  -->
                    
                        <div class="next-post">
                            <div class="next">下一篇</div>
                            <a href="https://mengxiaoxu.github.io//post/du-da-xue-de-ji-dian-jian-yi">
                                <h3 class="post-title">
                                    读大学的几点建议
                                </h3>
                            </a>
                        </div>
                        
                            <div id="disqus_thread"></div>
                            <div id="gitalk-container"></div>
                </div>
                <!-- middle -->
                <div class="main-container-middle"></div>
                <!-- right -->
                <div id="sidebar" class="main-container-right">
                    
                                <!-- id-card -->
                                
    <div class="id_card i-card">
        <div class="id_card-avatar" style="background-image: url(https://mengxiaoxu.github.io//images/avatar.png?v=1578407258539)">
        </div>
        <h1 class="id_card-title">
            刘小绪同学的博客
        </h1>
        <h2 class="id_card-description">
            正在学习写代码的码农
        </h2>
        <!--  -->
        <div class="id_card-sns">
            <!-- github -->
            
                <a href="https://github.com/mengxiaoxu" target="_blank" rel="noopener noreferrer"><i
                class="fa fa-github"></i></a>
                
                    <!-- twitter -->
                    
                        <a href="https://twitter.com/SlmpbWm59SPreqb" target="_blank" rel="noopener noreferrer"><i
                class="fa fa-twitter"></i></a>
                        
                            <!-- weibo -->
                            
                                    <!-- facebook -->
                                    
                                        <!-- douban -->
                                            <a href="https://www.douban.com/people/189583084" target="_blank" rel="noopener noreferrer"><i
                    class="icon-douban"></i></a>

        </div>
    </div>

    <div class="id_card i-card">
        <h1 class="id_card-title">
            最新文章
        </h1>
        <div class="new-aticles">
            
            
                <h3>
                    <a href="https://mengxiaoxu.github.io//post/2019-nian-zong-jie">2019 年总结</a>
                </h3>
            
            
            
                <h3>
                    <a href="https://mengxiaoxu.github.io//post/mongodb-ju-he-ru-men">MongoDB 聚合入门</a>
                </h3>
            
            
            
                <h3>
                    <a href="https://mengxiaoxu.github.io//post/yong-hu-guan-zhu-er-cheng-xu-yuan-bu-guan-zhu-de-shi">用户关注而程序员不关注的事</a>
                </h3>
            
            
            
                <h3>
                    <a href="https://mengxiaoxu.github.io//post/liu-xiao-xu-tong-xue-sui-bi">刘小绪同学随笔（2019-12-15）</a>
                </h3>
            
            
            
                <h3>
                    <a href="https://mengxiaoxu.github.io//post/linux-zhong-de-ling-kao-bei-ji-zhu">Linux 中的零拷贝技术</a>
                </h3>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
        </div>
    </div>
    
                                    

                </div>




            </div>


            <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://mengxiaoxu.github.io//atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>


    </div>
    <script>
        $('#sidebar').stickySidebar({
            topSpacing: 80,
            // bottomSpacing: 60
        });
    </script>
    
        
            <script>
    window.onload = function() {
        var gitalk = new Gitalk({
            clientID: '70b5a748b63425a6adfc',
            clientSecret: '35ad2482815fc609bacd858a7ff28cfd80a4e465',
            repo: 'mengxiaoxu.github.io',
            owner: 'mengxiaoxu',
            admin: ['mengxiaoxu'],
            id: (location.pathname).substring(0, 49), // Ensure uniqueness and length less than 50
            distractionFreeMode: false // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    }
</script>
                

                    
                                
</body>

</html>