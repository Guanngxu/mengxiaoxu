<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>用 Scrapy 爬取豆瓣250 | 刘小绪同学的博客</title>
<meta name="description" content="正在学习写代码的码农">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="https://mengxiaoxu.github.io//favicon.ico?v=1571463308454">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/papercss@1.6.1/dist/paper.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://mengxiaoxu.github.io//styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />


  </head>
  <body>
  
    <nav class="navbar border fixed split-nav">
  <div class="nav-brand">
    <h3><a href="https://mengxiaoxu.github.io/">刘小绪同学的博客</a></h3>
  </div>
  <div class="collapsible">
    <input id="collapsible1" type="checkbox" name="collapsible1">
    <button>
      <label for="collapsible1">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
      </label>
    </button>
    <div class="collapsible-body">
      <ul class="inline">
        
          <li>
            
              <a href="/" class="menu">
                首页
              </a>
            
          </li>
        
          <li>
            
              <a href="/archives" class="menu">
                归档
              </a>
            
          </li>
        
          <li>
            
              <a href="/tags" class="menu">
                标签
              </a>
            
          </li>
        
          <li>
            
              <a href="/post/about" class="menu">
                关于
              </a>
            
          </li>
        
          <li>
            
              <a href="https://mengxiaoxu.github.io//post/gao-zhi-liang-zhong-wen-du-li-bo-ke/" class="menu">
                友链
              </a>
            
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div id="top" class="row site">
      <div class="sm-12 md-8 col">
        <div class="paper">
          <article class="article">
            <h1>用 Scrapy 爬取豆瓣250</h1>
            <p class="article-meta">
              2018-07-27
              
                <a href="https://mengxiaoxu.github.io//tag/pa-chong" class="badge warning">
                  爬虫
                </a>
              
            </p>
            
              <img src="https://mengxiaoxu.github.io//post-images/yong-scrapy-pa-qu-dou-ban-250.jpeg" alt="用 Scrapy 爬取豆瓣250">
            
            <div class="post-content">
              <p>最好的学习方式就是输入之后再输出，分享一个自己学习scrapy框架的小案例，方便快速的掌握使用scrapy的基本方法。</p>
<p>本想从零开始写一个用Scrapy爬取教程，但是官方已经有了样例，一想已经有了，还是不写了，尽量分享在网上不太容易找到的东西。自己近期在封闭培训，更文像蜗牛一样，抱歉。</p>
<h4 id="scrapy简介">Scrapy简介</h4>
<p>Scrapy是一个为了爬取网站数据，提取结构性数据而编写的应用框架。 可以应用在包括数据挖掘，信息处理或存储历史数据等一系列的程序中。</p>
<p>其最初是为了 页面抓取 (更确切来说, 网络抓取 )所设计的， 也可以应用在获取API所返回的数据(例如 Amazon Associates Web Services ) 或者通用的网络爬虫。</p>
<figure data-type="image" tabindex="1"><img src="https://mengxiaoxu.github.io//post-images/1569769294059.png" alt=""></figure>
<p>如果此前对scrapy没有了解，请先查看下面的官方教程链接。</p>
<p>架构概览：<code>https://docs.pythontab.com/scrapy/scrapy0.24/topics/architecture.html</code></p>
<p>Scrapy入门教程：<code>https://docs.pythontab.com/scrapy/scrapy0.24/intro/tutorial.html</code></p>
<h4 id="爬虫教程">爬虫教程</h4>
<p>首先，我们看一下豆瓣TOP250页面，发现可以从中提取电影名称、排名、评分、评论人数、导演、年份、地区、类型、电影描述。</p>
<figure data-type="image" tabindex="2"><img src="https://mengxiaoxu.github.io//post-images/1569769306143.png" alt=""></figure>
<p>Item对象是种简单的容器，保存了爬取到得数据。其提供了类似于词典的API以及用于声明可用字段的简单语法。所以可以声明Item为如下形式。</p>
<pre><code class="language-python">class DoubanItem(scrapy.Item):
    # 排名
    ranking = scrapy.Field()
    # 电影名称
    title = scrapy.Field()
    # 评分
    score = scrapy.Field()
    # 评论人数
    pople_num = scrapy.Field()
    # 导演
    director = scrapy.Field()
    # 年份
    year = scrapy.Field()
    # 地区
    area = scrapy.Field()
    # 类型
    clazz = scrapy.Field()
    # 电影描述
    decsription = scrapy.Field()
</code></pre>
<p>我们抓取到相应的网页后，需要从网页中提取自己需要的信息，可以使用xpath语法，我使用的是BeautifulSoup网页解析器，经过BeautifulSoup解析的网页，可以直接使用选择器筛选需要的信息。有一些说明写到代码注释里面去了，就不再赘述。</p>
<p>Chrome 也可以直接复制选择器或者XPath，如下图所示。</p>
<figure data-type="image" tabindex="3"><img src="https://mengxiaoxu.github.io//post-images/1569769316497.png" alt=""></figure>
<pre><code class="language-python">class douban_spider(Spider):

    count = 1

    # 爬虫启动命令
    name = 'douban'

    # 头部信息，伪装自己不是爬虫程序
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36',
    }

    # 爬虫启动链接
    def start_requests(self):
        url = 'https://movie.douban.com/top250'
        yield Request(url, headers=self.headers)

    # 处理爬取的数据
    def parse(self, response):

        print('第', self.count, '页')
        self.count += 1

        item = DoubanItem()
        soup = BeautifulSoup(response.text, 'html.parser')

        # 选出电影列表
        movies = soup.select('#content div div.article ol li')

        for movie in movies:
            item['title'] = movie.select('.title')[0].text
            item['ranking'] = movie.select('em')[0].text
            item['score'] = movie.select('.rating_num')[0].text
            item['pople_num'] = movie.select('.star span')[3].text

            # 包含导演、年份、地区、类别
            info = movie.select('.bd p')[0].text
            director = info.strip().split('\n')[0].split('   ')
            yac = info.strip().split('\n')[1].strip().split(' / ')

            item['director'] = director[0].split(': ')[1]
            item['year'] = yac[0]
            item['area'] = yac[1]
            item['clazz'] = yac[2]

            # 电影描述有为空的，所以需要判断
            if len(movie.select('.inq')) is not 0:
                item['decsription'] = movie.select('.inq')[0].text
            else:
                item['decsription'] = 'None'
            yield item

        # 下一页：
        # 1，可以在页面中找到下一页的地址
        # 2，自己根据url规律构造地址，这里使用的是第二种方法
        next_url = soup.select('.paginator .next a')[0]['href']
        if next_url:
            next_url = 'https://movie.douban.com/top250' + next_url
            yield Request(next_url, headers=self.headers)
</code></pre>
<p>然后在项目文件夹内打开cmd命令，运行<code>scrapy crawl douban -o movies.csv</code>就会发现提取的信息就写入指定文件了，下面是爬取的结果，效果很理想。</p>
<figure data-type="image" tabindex="4"><img src="https://mengxiaoxu.github.io//post-images/1569769328594.png" alt=""></figure>

            </div>
          </article>
        </div>
        <div class="paper" data-aos="fade-in">
          
            <div class="next-post">
              <div class="next">
                下一篇
              </div>
              <a href="https://mengxiaoxu.github.io//post/nian-qing-bu-yao-gei-zi-ji-she-xian">
                <h3 class="post-title">
                  年轻不要给自己设限
                </h3>
              </a>
            </div>
          
        </div>
        
          
            <div class="paper" data-aos="fade-in">
              <div id="gitalk-container"></div>
            </div>
          

          
        
      </div>

      <div class="sm-12 md-4 col sidebar">
  <div class="paper info-container">
    <img src="https://mengxiaoxu.github.io//images/avatar.png?v=1571463308454" class="no-responsive avatar">
    <div class="text-muted">正在学习写代码的码农</div>
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      最新文章
    </div>
    <div class="row">
      <ul>
        
          
            <li>
              <a href="https://mengxiaoxu.github.io//post/javascript-gao-ji-zhi-shi-ji-qiao">JavaScript 高级知识技巧</a>
            </li>
          
        
          
            <li>
              <a href="https://mengxiaoxu.github.io//post/jia-li-de-gou">家里的狗</a>
            </li>
          
        
          
            <li>
              <a href="https://mengxiaoxu.github.io//post/o9IjztOrR">怎样才能开开心心的呢？</a>
            </li>
          
        
          
            <li>
              <a href="https://mengxiaoxu.github.io//post/bian-liang-ti-sheng-yu-zuo-yong-yu">变量提升与作用域</a>
            </li>
          
        
          
            <li>
              <a href="https://mengxiaoxu.github.io//post/duo-xing-zai-ru-han-shu">惰性载入函数</a>
            </li>
          
        
          
            <li>
              <a href="https://mengxiaoxu.github.io//post/fei-she-ji-shi-xu-yao-zhi-dao-de-si-ge-she-ji-yuan-ze">非设计师需要知道的四个设计原则</a>
            </li>
          
        
          
            <li>
              <a href="https://mengxiaoxu.github.io//post/liu-xiao-xu-tong-xue-sui-bi-2019-05-12">刘小绪同学随笔（2019-05-12）</a>
            </li>
          
        
          
            <li>
              <a href="https://mengxiaoxu.github.io//post/qCt13nLLT">浅析浏览器缓存机制</a>
            </li>
          
        
          
            <li>
              <a href="https://mengxiaoxu.github.io//post/git-jin-jie-ji-chang-yong-ming-ling">Git 进阶及常用命令</a>
            </li>
          
        
          
            <li>
              <a href="https://mengxiaoxu.github.io//post/shi-me-shi-qi-yue-ce-shi">什么是契约测试？</a>
            </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </ul>
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      标签列表
    </div>
    <div class="row">
      
        <a href="https://mengxiaoxu.github.io//tag/javascript" class="badge success">
          JavaScript
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/Cp4eHBEcz" class="badge success">
          前端
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/san-wen" class="badge secondary">
          散文
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/Z_0XCM_Cy" class="badge warning">
          随笔
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/94PzxqinO" class="badge ">
          生活感悟
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/i4kET55EC" class="badge ">
          翻译
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/vhSkGeYf1D" class="badge secondary">
          设计
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/S57Vp3Suu" class="badge warning">
          计算机网络
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/git" class="badge secondary">
          Git
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/QjCHA76i_r" class="badge secondary">
          编程基础
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/ce-shi" class="badge success">
          测试
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/qian-hou-duan-fen-chi" class="badge success">
          前后端分离
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/EE1uiCHgH" class="badge secondary">
          个人总结
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/J_3GE6pBm" class="badge secondary">
          TypeScript
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/shu-ji-tui-jian" class="badge secondary">
          书籍推荐
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/DytBq-ZFD" class="badge secondary">
          回忆
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/kvSwja8aw" class="badge secondary">
          操作系统
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/gong-ju-ji-qiao" class="badge secondary">
          工具技巧
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/pa-chong" class="badge secondary">
          爬虫
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/zi-ran-yu-yan-chu-li" class="badge warning">
          自然语言处理
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/shu-ju-ku" class="badge warning">
          数据库
        </a>
      
        <a href="https://mengxiaoxu.github.io//tag/JYJKwJM69" class="badge success">
          编译原理
        </a>
      
    </div>
  </div>
  <div class="paper">
    Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://mengxiaoxu.github.io//atom.xml" target="_blank">RSS</a>
  </div>
</div>


    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

</script>



  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '70b5a748b63425a6adfc',
        clientSecret: '35ad2482815fc609bacd858a7ff28cfd80a4e465',
        repo: 'mengxiaoxu.github.io',
        owner: 'mengxiaoxu',
        admin: ['mengxiaoxu'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
